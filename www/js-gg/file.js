(function(d){function m(a,c,g,e){var f,h,i,j,b,k=function(a){if(!a)return"";var b=a.lastIndexOf("\\");b<0&&(b=a.lastIndexOf("/"));return b<0?a:a.substr(b+1)},l=function(a){window.open(IDS_CONTEXT_PATH+"/attach/download?id="+a.data[0].id)},o=function(a){var b=a.data[1],a=d.toJSON({id:a.data[0].id});d.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/attach/delete",data:a,dataType:"json",success:function(){b.remove()},error:function(){ajaxError(arguments,this)}})};if(c)for(f=0;f<
c.length;f++)h=c[f],i=k(h.file.filename),j=d(document.createElement("div")),j.addClass("att"),g?(b=d(document.createElement("a")),b.addClass("att"),b.addClass("ellipsis"),b.click([h],l),b.attr("title",i+"("+h.file.size+" bytes)")):(b=d(document.createElement("span")),b.addClass("att"),b.addClass("ellipsis")),b.text(i),j.append(b),e&&(i=d(document.createElement("a")),i.text("\u5220\u9664"),i.addClass("del"),i.click([h,j],o),j.append(i)),a.append(j)}function n(a){var c=d.browser;try{if(a.files[0])return a.files[0].fileSize;
else if(c.msie&&c.version>=5&&c.version<=6){var g=new Image;g.src=a.value;return g.fileSize}else{a.select();var e=document.selection.createRange().text;return(new ActiveXObject("Scripting.FileSystemObject")).GetFile(e).fileSize}}catch(f){}return-1}d.IDS_FILE=d.IDS_FILE||{version:"1.0.0",name:"IDS_FILE"};d.extend(d.IDS_FILE,{jup:function(a){var c=a.qobj,g=a.obj,e=a.cat,f=a.uploadable,h=a.qatts,i=a.atts,j=a.params,a=g.id,b,k;h.children().remove();m(h,i,true,f);try{c[0].tagName=="A"&&(f?(c.text("\u6dfb\u52a0\u9644\u4ef6"),
c.addClass("enabled"),new AjaxUpload(c,{action:IDS_CONTEXT_PATH+"/attach/upload",data:{cat:e,owner:a,idx:0},onSubmit:function(a,b){if(b&&/^(exe)$/.test(b))return MessageBox("\u7cfb\u7edf\u7981\u6b62\u4e0a\u4f20\u540e\u7f00\u4e3a{EXT}\u7684\u6587\u4ef6!".replace("{EXT}",b),null,MB_ICONERROR,MB_OK,null,0),false;if(n(this._input)>20971520)return MessageBox("\u6587\u4ef6[{FILE}]\u7684\u5927\u5c0f\u8d85\u8fc7\u4e8620MB".replace("{FILE}",a),null,MB_ICONERROR,MB_OK,null,0),false},onComplete:function(a,c){b=
d.evalJSON(c);b.error?(k=b.error=="size.limit.exceeded"?"\u6587\u4ef6[{FILE}]\u7684\u5927\u5c0f\u8d85\u8fc7\u4e8620MB".replace("{FILE}",a):b.error,MessageBox("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25:\n"+k,null,MB_ICONERROR,MB_OK,null,0)):(m(h,b.atts,true,f),typeof j.event=="function"&&j.event(g,e,a,b,j))}})):(c.text("\u9644\u4ef6"),c.addClass("disabled")))}catch(l){_alert(l)}},iup:function(a){var c=a.qobj,g=a.params,e,f;try{new AjaxUpload(c,{action:IDS_CONTEXT_PATH+"/upload",data:{},onSubmit:function(a,
c){if(!c||!/^(bmp|gif|jpg|jpeg|png|tiff)$/.test(c))return MessageBox("\u53ea\u5141\u8bb8\u4e0a\u4f20\u56fe\u7247\u6587\u4ef6!",null,MB_ICONERROR,MB_OK,null,0),false;if(n(this._input)>20971520)return MessageBox("\u6587\u4ef6[{FILE}]\u7684\u5927\u5c0f\u8d85\u8fc7\u4e8620MB".replace("{FILE}",a),null,MB_ICONERROR,MB_OK,null,0),false},onComplete:function(a,c){e=d.evalJSON(c);e.error?(f=e.error=="size.limit.exceeded"?"\u6587\u4ef6[{FILE}]\u7684\u5927\u5c0f\u8d85\u8fc7\u4e8620MB".replace("{FILE}",a):e.error,
MessageBox("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25:\n"+f,null,MB_ICONERROR,MB_OK,null,0)):typeof g.event=="function"&&g.event(a,e,g)}})}catch(h){_alert(h)}}})})(jQuery);
