(function(a){function z(b){for(var a=0;a<t.length;a++)a==b-1?t[a].show():t[a].hide()}function r(b){a("#job_buttons").attr("title",b)}function v(){z(0);a("#job_buttons").hide()}function l(b,c){var d=a.toJSON({id:b.id});a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/open",data:d,dataType:"json",success:function(d){a.IDS_JOB.openJob(d,c);a.extend(b,d.job)},error:function(){ajaxError(arguments,this)}})}function j(b,a,d,f){if(typeof b[f]=="function")b[f](b,a,d);else if(typeof a[f]==
"function")a[f](b,a,d)}function n(a,c,d){var f=function(){v();j(a,c,d,"#onJobReturn")},e=function(a){a==ID_YES&&f()};a["#changed"]()?MessageBox("\u60a8\u7684\u63d0\u6848\u8fd8\u6ca1\u6709\u4fdd\u5b58, \u60a8\u786e\u5b9a\u79bb\u5f00\u5417?",IDS_TITLE,MB_ICONQUESTION,MB_YESNO,e,0):f()}function A(b){var c=a(b.target),d=b.originalEvent,b=b.type,f=c.val();b=="beforepaste"&&(f=clipboardData.getData("text"));if(!K.test(f))c.val(""),b=="beforepaste"&&clipboardData.setData("text",""),MessageBox("\u5fc5\u987b\u8f93\u5165\u6570\u5b57(\u5141\u8bb82\u4f4d\u5c0f\u6570)!",
IDS_TITLE,MB_ICONWARNING,MB_OK,null,1),d.returnValue=false}function L(){MessageBox("\u7cfb\u7edf\u9519\u8bef: \u672a\u627e\u5230\u5bf9\u5e94\u9875\u9762!",IDS_TITLE,MB_ICONERROR,MB_OK,null,6);return false}function M(b,c,d,f){var e;e=c==o?b.status=="NEW"?[{text:"\u4fee\u6539",click:N},{text:"\u5220\u9664",click:O},{text:"\u8fd4\u56de",click:n}]:[{text:"\u63d0\u4ea4",click:P},{text:"\u8fd4\u56de",click:n}]:[{text:"\u8fd4\u56de",click:n}];a("#job_buttons").addButtons(e,{data:[b,f]});a("#p1_cat").addOptions(d["job.cats"]);
a("#p1_area").addOptions(d["job.areas"]);a("#p1_team").addOptions(d["job.teams"],{text:"name"});a("#p1_fsFlag").addOptions(d["job.fsFlags"],{svalue:"N"});b.cat&&a("#p1_cat").val(b.cat);b.area&&a("#p1_area").val(b.area);e={team:a("#p1_team"),group:a("#p1_group"),job:b};var g=null;b.dept1&&(g=Q(d["job.teams"],b.dept1));g&&a("#p1_team").val(g.code);w({data:[e]});b.dept1&&a("#p1_group").val(b.dept1);a("#p1_team").bind("change",[e],w);a("#p1_fsFlag").bind("change",B);b.fsFlag&&a("#p1_fsFlag").val(b.fsFlag);
a("#p1_title").val(b.title?b.title:"");a("#p1_content").val(b.content?b.content:"");a("#p1_fsValue").val(b.fsValue?b.fsValue:"");a("#p1_fsFormula").val(b.fsFormula?b.fsFormula:"");e=b["#app"];g=b.act?b.act.actor:null;e?(a("#p1d_app").addClass("show"),a("#p1_app").text(e.name+"["+e.pernr+"]")):a("#p1d_app").addClass("hide");g?(a("#p1d_actor").addClass("show"),a("#p1_actor").text(g.name+"["+g.pernr+"]")):a("#p1d_actor").addClass("hide");e=a("#p1_cat, #p1_area, #p1_team, #p1_group, #p1_title, #p1_content, #p1_fsFlag, #p1_fsValue, #p1_fsFormula");
d={qobj:a("#p1_uploader"),obj:b,cat:"JOB",uploadable:true,qatts:a("#p1_atts"),atts:d["job.atts"],params:f};c==o?(a("#p1_title").itip("\u8bf7\u8f93\u5165\u9898\u76ee"),a("#p1_content").itip("\u8bf7\u8f93\u5165\u8be6\u7ec6\u5185\u5bb9"),a("#p1_fsValue").itip("\u8bf7\u8f93\u5165\u8d22\u52a1\u6210\u679c\u7ed3\u679c"),a("#p1_fsFormula").itip("\u8bf7\u8f93\u5165\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f"),e.each(function(){a(this).attr("_value",a(this).val());this.tagName=="SELECT"?a(this).removeAttr("disabled"):
a(this).removeAttr("readonly")}),b["#checkItems"]=e):(b["#check"]=false,a("#p1_title").itip(""),a("#p1_content").itip(""),a("#p1_fsValue").itip(""),a("#p1_fsFormula").itip(""),e.each(function(){this.tagName=="SELECT"?a(this).attr("disabled",true):a(this).attr("readonly","readonly")}),d.uploadable=false);a.IDS_FILE.jup(d);B();a("#p1_fsValue").bind("keyup",A);a("#p1_fsValue").bind("beforepaste",A);c=b.status=="PASS2"||b.status=="REJ2"?2:b.status=="PASS1"||b.status=="REJ1"?1:0;c>1?(a("#p1_app2").show(),
a("#p1_comment2").val("\u5ba1\u6279\u610f\u89c1: "+b.comment2)):a("#p1_app2").hide();c>0?(a("#p1_app1").show(),a("#p1_comment1").val("\u5ba1\u6279\u610f\u89c1: "+b.comment1)):a("#p1_app1").hide();r("PAGE1: \u63d0\u4ea4/\u67e5\u770b/\u4fee\u6539\u81ea\u5df1\u7684\u63d0\u6848")}function R(b){var c="",d;b.title.empty()?(c="\u8bf7\u8f93\u5165\u63d0\u6848\u4e3b\u9898!",d=a("#p1_title")):b.content.empty()?(c="\u8bf7\u8f93\u5165\u63d0\u6848\u5185\u5bb9!",d=a("#p1_content")):b.fsFlag=="Y"&&b.fsValue.empty()&&
(c="\u8bf7\u8f93\u5165\u8d22\u52a1\u6210\u679c\u7ed3\u679c!",d=a("#p1_fsValue"));c&&MessageBox(c,null,MB_ICONERROR,MB_OK,function(){d.focus()});return c==""}function C(a){var a=a.data[0],c=a.team,d=a.job,f=d.approver1?d.approver1.team:null,d=d.approver2?d.approver2.team:null;a.area.val()=="ZDEP"?c.val(f):c.val(d);c.trigger("change")}function w(b){var c=b.data[0],b=c.team.get(0);if(b=a(b.options[b.selectedIndex]).data()){var b=b.hasOwnProperty("groups")?b.groups:[],d=c.group,f=c.job,c=a("#p2_area").val(),
e=f&&f.approver1?f.approver1.groupCode:null,f=f&&f.approver2?f.approver2.groupCode:null;c=="ZDEP"?d.addOptions(b,{text:"name",svalue:e,blank:true}):d.addOptions(b,{text:"name",svalue:f,blank:true});d.trigger("change")}}function S(b){b=b.data[0];if(b.group.val()==b.dept0.code){a("#p2_app1").show();for(var c=0;c<b.emps.length;c++)b.emps[c]["#label"]=b.emps[c].pernr+"["+b.emps[c].name+"]";a("#p2_actors").addOptions(b.emps,{value:"pernr",text:"#label"});a("#p2_planTime").datepicker({minDate:new Date})}else a("#p2_app1").hide()}
function B(){a("#p1_fsFlag").val()=="Y"?(a("#p1_fsFormula").removeAttr("readonly"),a("#p1_fsValue").removeAttr("readonly")):(a("#p1_fsFormula").val(""),a("#p1_fsFormula").attr("readonly",""),a("#p1_fsValue").val(""),a("#p1_fsValue").attr("readonly",""))}function Q(a,c){var d,f;for(d=0;d<a.length;d++)if(f=a[d],f.groups[c])return f;return null}function D(b,c,d,f){var e=function(){j(b,c,d,f)},g={id:b.id,cat:a("#p1_cat").val(),area:a("#p1_area").val(),dept1:a("#p1_group").val(),title:a("#p1_title").val(),
content:a("#p1_content").val(),fsFlag:a("#p1_fsFlag").val(),fsValue:a("#p1_fsValue").val(),fsFormula:a("#p1_fsFormula").val(),extra:{me:IDS_ACC.pernr}};R(g)&&(g=a.toJSON(g),a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/process",data:g,dataType:"json",success:function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(b,c),MessageBox(a.message,null,MB_ICONINFORMATION,MB_OK,e,0))},error:function(){ajaxError(arguments,this)}}))}function P(a,c,d){D(a,c,
d,"#onJobAdd")}function N(a,c,d){D(a,c,d,"#onJobSave")}function O(b,c,d){var f=function(){j(b,c,d,"#onJobDelete")},e=function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):MessageBox(a.message,null,MB_ICONINFORMATION,MB_OK,f,0)},g=function(b){b=a.toJSON({id:b.id,extra:{me:IDS_ACC.pernr}});a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/delete",data:b,dataType:"json",success:e,error:function(){ajaxError(arguments,this)}})};MessageBox("\u786e\u5b9e\u8981\u5220\u9664\u63d0\u6848["+
b.title+"]\u5417?",null,MB_ICONQUESTION,MB_YESNO,function(a){a==ID_YES&&g(b)},0)}function T(b,c,d,f){var e;e=c==o?[{text:"\u540c\u610f",click:U},{text:"\u62d2\u6279",click:V},{text:"\u8fd4\u56de",click:n}]:[{text:"\u8fd4\u56de",click:n}];a("#job_buttons").addButtons(e,{data:[b,f]});var g=b.requester;e=d["job.dept0"];var i=d["job.dept1"],m=new Date(b.reqTime),h=d["job.cat"];a("#p2_reqTime").text(m.format(IDS_FORMAT_DATE));a("#p2_reqTime").attr("title",m.format(IDS_FORMAT_DATE));a("#p2_dept0").text(g.dept);
a("#p2_dept0").attr("title",g.dept);a("#p2_requesterName").text(g.name);a("#p2_requesterName").attr("title",g.name);a("#p2_requester").text(g.pernr);a("#p2_requester").attr("title",g.pernr);a("#p2_cat").text(h.text);a("#p2_cat").attr("title",h.text);a("#p2_dept1").text(i.name);a("#p2_dept1").attr("title",i.name);a("#p2_requesterSin").text(g.mysin);a("#p2_requesterSin").attr("title",g.mysin);a("#p2_requesterDuty").text(g.duty);a("#p2_requesterDuty").attr("title",g.duty);a("#p2_requesterTel").text(g.tel);
a("#p2_requesterTel").attr("title",g.tel);a("#p2_fsValue").text(b.fsValue);a("#p2_fsValue").attr("title",b.fsValue);a("#p2_title").text("\u9898\u76ee: "+b.title);a("#p2_content").text("\u8be6\u7ec6\u5185\u5bb9: "+b.content);a("#p2_fsFormula").text("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+(b.fsFormula?b.fsFormula:""));a("#p2_comment1").text(b.comment1);b.comment2?(a("#p2_comment2p").show(),a("#p2_comment2").text(b.comment2),a("#p2_comment2").attr("readonly","readonly")):a("#p2_comment2p").hide();
f={qobj:a("#p2_uploader"),obj:b,cat:"JOB",uploadable:false,qatts:a("#p2_atts"),atts:d["job.atts"],params:f};a.IDS_FILE.jup(f);f={area:a("#p2_area"),team:a("#p2_team"),group:a("#p2_group"),job:b,dept0:e,teams:d["job.teams"],emps:d["act.emps"]};g={team:a("#p2_team"),group:a("#p2_group"),job:b};i={group:a("#p2_group"),dept0:e,emps:d["act.emps"]};a("#p2_area").bind("change",[f],C);a("#p2_team").bind("change",[g],w);a("#p2_group").bind("change",[i],S);a("#p2_area").addOptions(d["job.areas"],{svalue:b.area,
blank:true});a("#p2_team").addOptions(d["job.teams"],{text:"name",blank:true});C({data:[f]});b.dept0=e;c==o?a("#p2_comment1").itip("\u8bf7\u8f93\u5165\u5ba1\u6279\u610f\u89c1"):(a("#p2_comment1").val("\u5ba1\u6279\u610f\u89c1: "+b.comment1),a("#p2_comment1").attr("readonly","readonly"));r("PAGE2: \u672c\u90e8\u95e8\u63d0\u6848\u5ba1\u6279")}function W(b){var c="",d,f=b.extra.agree;typeof f=="undefined"&&(f=true);if(f){if(b.area==""||b.team==""||b.dept2=="")c="\u8bf7\u6307\u5b9a\u63d0\u6848["+b.title+
"]\u7684\u6539\u5584\u90e8\u95e8!";a("#p2_group").val()==b.dept0.code&&(a("#p2_actors").val().empty()?(c="\u8bf7\u6307\u5b9a\u6539\u5584\u8005!",d=a("#p2_actors")):a("#p2_planTime").val().empty()&&(c="\u8bf7\u6307\u5b9a\u7eb3\u671f!",d=a("#p2_planTime")))}else a("#p2_comment1").val().empty()&&(c="\u8bf7\u586b\u5199\u5ba1\u6279\u610f\u89c1\uff08\u62d2\u6279\u539f\u56e0\uff09!",d=a("#p2_comment1"));c&&MessageBox(c,null,MB_ICONERROR,MB_OK,function(){d&&d.focus()});return c==""}function E(b,c,d,f){var e=
function(){j(b,c,null,f)},d={id:b.id,title:b.title,comment1:a("#p2_comment1").val(),area:a("#p2_area").val(),team:a("#p2_team").val(),dept2:a("#p2_group").val(),dept0:b.dept0,extra:{me:IDS_ACC.pernr,actors:a("#p2_actors").val(),planTime:a("#p2_planTime").val(),agree:d}};W(d)&&(d=a.toJSON(d),a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/process",data:d,dataType:"json",success:function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(b,c),MessageBox(a.message,
null,MB_ICONINFORMATION,MB_OK,e,0))},error:function(){ajaxError(arguments,this)}}))}function U(a,c){E(a,c,true,"#onJobPass1")}function V(a,c){E(a,c,false,"#onJobRej1")}function X(b,c,d,f){var e;e=c==o?[{text:"\u540c\u610f",click:Y},{text:"\u62d2\u6279",click:Z},{text:"\u8fd4\u56de",click:n}]:[{text:"\u8fd4\u56de",click:n}];a("#job_buttons").addButtons(e,{data:[b,f]});e=b.requester;var g=d["job.dept1"],i=new Date(b.reqTime),m=d["job.cat"];a("#p3_reqTime").text(i.format(IDS_FORMAT_DATE));a("#p3_reqTime").attr("title",
i.format(IDS_FORMAT_DATE));a("#p3_dept0").text(e.dept);a("#p3_dept0").attr("title",e.dept);a("#p3_requesterName").text(e.name);a("#p3_requesterName").attr("title",e.name);a("#p3_requester").text(e.pernr);a("#p3_requester").attr("title",e.pernr);a("#p3_cat").text(m.text);a("#p3_cat").attr("title",m.text);a("#p3_dept1").text(g.name);a("#p3_dept1").attr("title",g.name);a("#p3_requesterSin").text(e.mysin);a("#p3_requesterSin").attr("title",e.mysin);a("#p3_requesterDuty").text(e.duty);a("#p3_requesterDuty").attr("title",
e.duty);a("#p3_requesterTel").text(e.tel);a("#p3_requesterTel").attr("title",e.tel);a("#p3_fsValue").text(b.fsValue);a("#p3_fsValue").attr("title",b.fsValue);a("#p3_title").text("\u9898\u76ee: "+b.title);a("#p3_content").text("\u8be6\u7ec6\u5185\u5bb9: "+b.content);a("#p3_fsFormula").text("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+(b.fsFormula?b.fsFormula:""));a("#p3_comment1").val("\u5ba1\u6279\u610f\u89c1: "+b.comment1);a("#p3_comment2").val(b.comment2);f={qobj:a("#p3_uploader"),obj:b,
cat:"JOB",uploadable:false,qatts:a("#p3_atts"),atts:d["job.atts"],params:f};a.IDS_FILE.jup(f);d=d["act.emps"];f=(e=b.act)&&e.actor?e.actor.pernr:null;e=e&&e.planTime?(new Date(e.planTime)).format(IDS_FORMAT_DATE):null;if(c==o){a("#p3_app2").show();for(b=0;b<d.length;b++)d[b]["#label"]=d[b].pernr+"["+d[b].name+"]";a("#p3_actors").addOptions(d,{value:"pernr",svalue:f,text:"#label"});a("#p3_planTime").val(e);a("#p3_planTime").datepicker({defaultDate:e,minDate:new Date});a("#p3_comment2").itip("\u8bf7\u8f93\u5165\u5ba1\u6279\u610f\u89c1")}else a("#p3_comment2").val("\u5ba1\u6279\u610f\u89c1: "+
b.comment2),a("#p3_comment2").attr("readonly","readonly");r("PAGE3: \u4ed6\u90e8\u95e8\u63d0\u6848\u534f\u8bae")}function $(b){var c="",d;b.extra.agree?a("#p3_actors").val().empty()?(c="\u8bf7\u6307\u5b9a\u6539\u5584\u8005!",d=a("#p3_actors")):a("#p3_planTime").val().empty()&&(c="\u8bf7\u6307\u5b9a\u7eb3\u671f!",d=a("#p3_planTime")):a("#p3_comment2").val().empty()&&(c="\u8bf7\u586b\u5199\u5ba1\u6279\u610f\u89c1\uff08\u62d2\u6279\u539f\u56e0\uff09!",d=a("#p3_comment2"));c&&MessageBox(c,null,MB_ICONERROR,
MB_OK,function(){d.focus()});return c==""}function F(b,c,d,f){var e=function(){j(b,c,null,f)},g={id:b.id,comment2:a("#p3_comment2").val(),extra:{me:IDS_ACC.pernr,actors:a("#p3_actors").val(),planTime:a("#p3_planTime").val(),agree:d}};$(g,d)&&(d=a.toJSON(g),a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/process",data:d,dataType:"json",success:function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(b,c),MessageBox(a.message,null,MB_ICONINFORMATION,
MB_OK,e,0))},error:function(){ajaxError(arguments,this)}}))}function Y(a,c){F(a,c,true,"#onJobPass2")}function Z(a,c){F(a,c,false,"#onJobRej2")}function aa(b,c,d,f){var e=b.act,g;g=c==o?e.approver1Nr?[{text:"\u4fee\u6539",click:G},{text:"\u8fd4\u56de",click:s}]:[{text:"\u63d0\u4ea4",click:ba},{text:"\u4fee\u6539",click:G},{text:"\u8fd4\u56de",click:s}]:[{text:"\u8fd4\u56de",click:s}];a("#job_buttons").addButtons(g,{data:[b,f]});g=b.requester;var i=new Date(b.reqTime),m=d["job.cat"];a("#p4_cat").text(m.text);
a("#p4_cat").attr("title",m.text);a("#p4_fsValue").text(b.fsValue);a("#p4_fsValue").attr("title",b.fsValue);a("#p4_reqTime").text(i.format(IDS_FORMAT_DATE));a("#p4_reqTime").attr("title",i.format(IDS_FORMAT_DATE));a("#p4_dept0").text(g.dept);a("#p4_dept0").attr("title",g.dept);a("#p4_requesterName").text(g.name);a("#p4_requesterName").attr("title",g.name);a("#p4_requester").text(g.pernr);a("#p4_requester").attr("title",g.pernr);a("#p4_requesterSin").text(g.mysin);a("#p4_requesterSin").attr("title",
g.mysin);a("#p4_requesterDuty").text(g.duty);a("#p4_requesterDuty").attr("title",g.duty);a("#p4_requesterTel").text(g.tel);a("#p4_requesterTel").attr("title",g.tel);g=e.actor;i=e.actTime?(new Date(e.actTime)).format(IDS_FORMAT_DATE):"";a("#p4_actTime").text(i);a("#p4_actTime").attr("title",i);a("#p4_dept2").text(g.dept);a("#p4_dept2").attr("title",g.dept);a("#p4_actorName").text(g.name);a("#p4_actorName").attr("title",g.name);a("#p4_actor").text(g.pernr);a("#p4_actor").attr("title",g.pernr);a("#p4_actorSin").text(g.mysin);
a("#p4_actorSin").attr("title",g.mysin);a("#p4_actorDuty").text(g.duty);a("#p4_actorDuty").attr("title",g.duty);a("#p4_actorTel").text(g.tel);a("#p4_actorTel").attr("title",g.tel);a("#p4_title").text("\u9898\u76ee: "+b.title);a("#p4_content").text("\u8be6\u7ec6\u5185\u5bb9: "+b.content);a("#p4_fsFormula").text("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+(b.fsFormula?b.fsFormula:""));a("#p4_comment2").val("\u5ba1\u6279\u610f\u89c1: "+b.comment2);b={qobj:a("#p4_uploader"),obj:b,cat:"JOB",uploadable:false,
qatts:a("#p4_atts"),atts:d["job.atts"],params:f};a.IDS_FILE.jup(b);d={qobj:a("#p4a_uploader"),obj:e,cat:"ACT",uploadable:true,qatts:a("#p4a_atts"),atts:d["act.atts"],params:f};c==o?(a("#p4a_content").removeAttr("readonly"),a("#p4a_content").val(e.content),a("#p4a_content").itip("\u8bf7\u8f93\u5165\u6539\u5584\u5185\u5bb9"),a("#p4a_fsFormula").removeAttr("readonly"),a("#p4a_fsFormula").val(e.fsFormula),a("#p4a_fsFormula").itip("\u8bf7\u8f93\u5165\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f")):
(a("#p4a_content").attr("readonly","readonly"),a("#p4a_content").val("\u6539\u5584\u5185\u5bb9: "+e.content),a("#p4a_fsFormula").attr("readonly","readonly"),a("#p4a_fsFormula").val("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+e.fsFormula),d.uploadable=false);a.IDS_FILE.jup(d);r("PAGE 4: \u63d0\u4ea4/\u67e5\u770b/\u4fee\u6539\u81ea\u5df1\u7684\u6539\u5584")}function ca(b){var c="",d;b.act.content.empty()&&(c="\u8bf7\u8f93\u5165\u6539\u5584\u5185\u5bb9!",d=a("#p4a_content"));c&&MessageBox(c,
null,MB_ICONERROR,MB_OK,function(){d.focus()});return c==""}function H(b,c,d,f,e){var g=function(){j(b,c,d,f)};typeof e=="undefined"&&(e=false);e={id:b.id,act:{id:b.act.id,content:a("#p4a_content").val(),fsFormula:a("#p4a_fsFormula").val()},extra:{me:IDS_ACC.pernr,submitted:e}};ca(e)&&(e=a.toJSON(e),a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/process",data:e,dataType:"json",success:function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(b,c),MessageBox(a.message,
null,MB_ICONINFORMATION,MB_OK,g,0))},error:function(){ajaxError(arguments,this)}}))}function ba(a,c,d){H(a,c,d,"#onActSubmit",true)}function G(a,c,d){H(a,c,d,"#onActSave")}function da(b,c,d,f){var e=b.act,g=d["act.score"]?d["act.score"]:null,i="",m=f.hasOwnProperty("#ro")&&f["#ro"]?true:false,h=b.requester,j=new Date(b.reqTime),l=d["job.cat"],k=d["act.actor"],n=new Date(e.actTime);a("#p5_cat").text(l.text);a("#p5_cat").attr("title",l.text);a("#p5_fsValue").text(b.fsValue);a("#p5_fsValue").attr("title",
b.fsValue);a("#p5_reqTime").text(j.format(IDS_FORMAT_DATE));a("#p5_reqTime").attr("title",j.format(IDS_FORMAT_DATE));a("#p5_dept0").text(h.dept);a("#p5_dept0").attr("title",h.dept);a("#p5_requesterName").text(h.name);a("#p5_requesterName").attr("title",h.name);a("#p5_requester").text(h.pernr);a("#p5_requester").attr("title",h.pernr);a("#p5_requesterSin").text(h.mysin);a("#p5_requesterSin").attr("title",h.mysin);a("#p5_requesterDuty").text(h.duty);a("#p5_requesterDuty").attr("title",h.duty);a("#p5_requesterTel").text(h.tel);
a("#p5_requesterTel").attr("title",h.tel);a("#p5_actTime").text(n.format(IDS_FORMAT_DATE));a("#p5_actTime").attr("title",n.format(IDS_FORMAT_DATE));a("#p5_dept2").text(k.dept);a("#p5_dept2").attr("title",k.dept);a("#p5_actorName").text(k.name);a("#p5_actorName").attr("title",k.name);a("#p5_actor").text(k.pernr);a("#p5_actor").attr("title",k.pernr);a("#p5_actorSin").text(k.mysin);a("#p5_actorSin").attr("title",k.mysin);a("#p5_actorDuty").text(k.duty);a("#p5_actorDuty").attr("title",k.duty);a("#p5_actorTel").text(k.tel);
a("#p5_actorTel").attr("title",k.tel);a("#p5_title").text("\u9898\u76ee: "+b.title);a("#p5_content").text("\u8be6\u7ec6\u5185\u5bb9: "+b.content);a("#p5_fsFormula").text("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+(b.fsFormula?b.fsFormula:""));a("#p5a_content").val("\u6539\u5584\u5185\u5bb9: "+e.content);a("#p5a_fsFormula").val("\u8d22\u52a1\u6210\u679c\u8ba1\u7b97\u516c\u5f0f: "+e.fsFormula);h={qobj:a("#p5_uploader"),obj:b,cat:"JOB",uploadable:false,qatts:a("#p5_atts"),atts:d["job.atts"],
params:f};a.IDS_FILE.jup(h);h={qobj:a("#p5a_uploader"),obj:e,cat:"ACT",uploadable:false,qatts:a("#p5a_atts"),atts:d["act.atts"],params:f};a.IDS_FILE.jup(h);a("#ss_div").dialog({autoOpen:false,modal:true,position:"top",resizable:false,width:820});a("#aa_div").dialog({autoOpen:false,modal:true,position:"top",resizable:false,width:820});h=[];j=function(){a("#aa_div").dialog("open");a.IDS_JOB.openAssign({job:b,params:f,"#onAssignSave":ea})};l=function(){a("#ss_div").dialog("open");a.IDS_JOB.openScore({job:b,
params:f,cat:i,data:d,"#onScoreSave":fa})};k=new Date;b["#passed"]()&&!m&&(IDS_ACC.admin&&h.push({text:"\u73b0\u573a\u5956\u52b1",click:j}),g&&g.approverNr==IDS_ACC.pernr&&k>=e.time3&&k<=e.time4&&(i="J",h.push({text:"\u73b0\u573a\u8bc4\u5206",click:l})));c==o&&!m?(i="S",h.push({text:"\u6539\u5584\u8bc4\u5206",click:l},{text:"\u8fd4\u56de",click:s})):h.push({text:"\u8fd4\u56de",click:s});a("#job_buttons").addButtons(h,{data:[b,f]});r("PAGE 5: \u6539\u5584\u5ba1\u6279")}function s(a,c,d){var f=function(){v();
j(a,c,d,"#onActReturn")},e=function(a){a==ID_YES&&f()};a["#changed"]()?MessageBox("\u60a8\u7684\u6539\u5584\u8fd8\u6ca1\u6709\u4fdd\u5b58, \u60a8\u786e\u5b9a\u79bb\u5f00\u5417?",IDS_TITLE,MB_ICONQUESTION,MB_YESNO,e,0):f()}function fa(b,c){var d=b&&b.job?b.job:null,f=b&&b.params?b.params:null;if(!d||!d.act||!d.act)MessageBox("\u7cfb\u7edf\u672a\u627e\u5230\u6b64\u63d0\u6848\u7684\u6539\u5584!",IDS_TITLE,MB_ICONERROR,MB_OK,null,0);else if(!c||c.cat!="S"&&c.cat!="J")MessageBox("\u975e\u6cd5\u7684\u8bc4\u5206\u7c7b\u578b!",
null,MB_ICONERROR,MB_OK,null,0);else{var e=function(){j(d,f,null,"#onActScore")},g={id:d.id,act:{id:d.act.id},extra:{me:IDS_ACC.pernr,score:c}};if(c.cat=="J")g.extra.command="score";a.ajax({type:"POST",contentType:"application/json",data:a.toJSON(g),dataType:"json",url:IDS_CONTEXT_PATH+"/job/process",success:function(a){a.error?MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(d,f),MessageBox(a.message,null,MB_ICONINFORMATION,MB_OK,e,0))},error:function(){ajaxError(arguments,this)}})}}function ea(b,
c){var d=b&&b.job?b.job:null,f=b&&b.params?b.params:null;if(!d||!d.act||!d.act)MessageBox("\u7cfb\u7edf\u672a\u627e\u5230\u6b64\u63d0\u6848\u7684\u6539\u5584!",IDS_TITLE,MB_ICONERROR,MB_OK,null,0);else{var e=function(){j(d,f,null,"#onActAssign")};a.ajax({type:"POST",contentType:"application/json",data:a.toJSON({id:d.id,act:{id:d.act.id,time3:c.time3,time4:c.time4},extra:{command:"assign",me:IDS_ACC.pernr,scorers:c.scorers}}),dataType:"json",url:IDS_CONTEXT_PATH+"/job/process",success:function(a){a.error?
MessageBox(a.message,null,MB_ICONERROR,MB_OK,null,0):(l(d,f),MessageBox(a.message,null,MB_ICONINFORMATION,MB_OK,e,0))},error:function(){ajaxError(arguments,this)}})}}for(var I={code:"UNK",text:"\u672a\u77e5\u7c7b\u578b"},J={code:"UNK",text:"\u672a\u77e5\u72b6\u6001"},K=/^(-?\d+)(\.\d{0,2})?$/,t=[],q=[],p=[],x={},o=1,y=[[[1,1],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[1,1],[2,1],[1,0],[1,0],[1,0],[1,0],[1,0]],[[1,0],[2,1],[3,1],[1,0],[1,0],[1,0],[1,0]],[[1,1],[2,1],[1,0],[1,0],[1,0],[1,0],[1,0]],[[1,
1],[2,1],[3,1],[1,0],[1,0],[1,0],[1,0]],[[3,0],[3,0],[3,0],[3,0],[3,0],[3,0],[3,0]],[[4,0],[4,0],[3,1],[4,1],[5,1],[4,0],[4,0]],[[4,0],[4,0],[4,0],[4,0],[5,1],[5,1],[4,0]],[[5,0],[5,0],[5,0],[4,1],[5,1],[5,0],[5,0]],[[5,0],[5,0],[5,0],[5,0],[5,0],[5,0],[5,0]],[[5,0],[5,0],[5,0],[4,1],[5,0],[5,1],[5,0]]],u=0;u<5;u++)t[u]=a("#job_p"+(u+1));var ga={"#type":function(){var a=IDS_ACC.pernr,c=I,d=this.act;d&&(d.approver1Nr==a||d.approver2Nr==a)?c=q[3]:d&&d.actorNr==a?c=q[2]:d&&d.actors&&d.actors.indexOf(a)>=
0?c=q[2]:this.approver1Nr==a||this.approver2Nr==a?c=q[3]:this.requesterNr==a&&(c=q[1]);return c?c:I},"#status":function(){var a=J,c=this.act;if(this.status=="PASS2"&&c)c.status=="PASS2"?a=p[4]:c.status=="REJ1"||c.status=="REJ2"?a=p[5]:c.status=="PASS1"?a=p[3]:c.status=="NEW"&&(a=p[2]);else if(this.status=="REJ1"||this.status=="REJ2")a=p[5];else if(this.status=="NEW"||this.status=="PASS1")a=p[1];return a?a:J},"#done":false,"#phase":0,"#who":0,"#step":function(){var a=[0,0],c=0,d=0,f=this.status,e=
(d=this.act)?d.status:null;f==null?c=0:f=="NEW"?c=1:f=="PASS1"?c=2:f=="REJ1"?c=3:f=="REJ2"?c=4:f=="DELETE"?c=5:f=="PASS2"&&(d==null||e=="NEW"?c=6:e=="PASS1"?c=7:e=="REJ1"?c=8:e=="PASS2"?c=9:e=="REJ2"&&(c=10));var f=this.requesterNr,e=this.approver1Nr,g=this.approver2Nr,i=d?d.actorNr:null,j=d?d.approver1Nr:null,h=IDS_ACC.pernr,d=h==(d?d.approver2Nr:null)?5:h==j?4:h==i?3:h==g?2:h==e?1:h==f?0:6;c>=0&&c<y.length&&d>=0&&d<y[c].length&&(a=y[c][d],this["#phase"]=c+1,this["#who"]=d+1);return{page:a[0],op:a[1]}},
"#approver":function(){var a=this.act,c=null;if(this.status=="PASS2"&&a)if(a.status=="PASS1"||a.status=="PASS2"||a.status=="REJ2")c=a.approver2;else{if(a.status=="NEW"||a.status=="REJ1")c=a.approver1}else if(this.status=="PASS1"||this.status=="REJ2")c=this.approver2;else if(this.status=="NEW"||this.status=="REJ1")c=this.approver1;return c},"#scorable":function(){var a=this.act;return this.status=="PASS2"&&a&&a.id>0},"#passed":function(){var a=this.act;return this.status=="PASS2"&&a&&a.id>0&&a.status==
"PASS2"&&a.score2>=60&&(a.rank2=="A"||a.rank2=="B")},"#check":false,"#checkItems":[],"#changed":function(){var b=false,c=this["#checkItems"];if(!c||c.length<=0||!this["#check"])return b;c.each(function(){var c=a(this).attr("_value");typeof c=="undefined"&&(c="");c!=a(this).val()&&(b=true)});return b},"#unload":function(){if(this["#changed"]())return"\u60a8\u7684\u63d0\u6848\u8fd8\u6ca1\u6709\u4fdd\u5b58, \u60a8\u786e\u5b9a\u79bb\u5f00\u5417?"},"#onJobReturn":null,"#onJobAdd":null,"#onJobSave":null,
"#onJobDelete":null,"#onJobPass1":null,"#onJobRej1":null,"#onJobPass2":null,"#onJobRej2":null,"#onAttUpload":null};a.IDS_JOB=a.IDS_JOB||{version:"1.0.0",name:"IDS_JOB"};a.extend(a.IDS_JOB,{RANK_SPEC:"\u8bc4\u4ef7\u7b49\u7ea7\uff1aA\u7b49\u7ea780\u5206\u4ee5\u4e0a\uff0cB\u7b49\u7ea760~80\u5206\uff0cC\u7b49\u7ea740~60\u5206\uff1bD\u7b49\u7ea70~40\u5206",setTypes:function(a){q=a},setStatus:function(a){p=a},setCats:function(a){var c;for(c=0;c<a.length;c++)x[a[c].code]=a[c]},getRank:function(a){return a>=
80?"A":a>=60?"B":a>=40?"C":"D"},initJob:function(b){a.extend(b,ga);b["#typeValue"]=b["#type"]();b["#typeText"]=b["#typeValue"].text;b["#statusValue"]=b["#status"]();b["#statusText"]=b["#statusValue"].text;if(b.requester)b["#dept1"]=b.requester.dept,b["#requester"]=b.requester.name;if(!b.fsFormula)b.fsFormula="";if(!b.comment1)b.comment1="";if(!b.comment2)b.comment2="";if(b.act){var c=b.act;if(!c.fsFormula)c.fsFormula="";if(!c.comment1)c.comment1="";if(!c.comment2)c.comment2="";b["#rank"]=c.rank2;
b["#score"]=c.score2}b["#catValue"]=x.hasOwnProperty(b.cat)?x[b.cat]:null;b["#catText"]=b["#catValue"]?b["#catValue"].text:null;b.status=="PASS2"&&b.act&&b.act.status=="PASS2"&&(b["#done"]=true);b["#app"]=b["#approver"]()},openJob:function(a,c){var d=a.job;this.initJob(d);var f=d["#step"]();z(f.page);var e=[L,M,T,X,aa,da];if(f.page>=0&&f.page<e.length&&typeof e[f.page]=="function"&&(f=e[f.page](d,f.op,a,c),typeof f!="undefined"&&!f))return false;d["#check"]=typeof c.check=="undefined"?true:c.check;
document.body.onbeforeunload=function(){return d["#unload"]()};return d},reloadJob:l,closeAll:v})})(jQuery);
