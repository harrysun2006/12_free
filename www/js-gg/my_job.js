(function(a){function i(b){var e=b.jobs;a("#data").jqGrid({autowidth:true,datatype:"local",height:"auto",colNames:["ID","\u65f6\u95f4","\u7c7b\u522b","\u4e3b\u9898","\u72b6\u6001"],colModel:[{name:"id",hidden:true},{name:"reqTime",index:"reqTime",formatter:"date",width:120,fixed:true,sortable:false,align:"center"},{name:"#typeText",width:100,fixed:true,sortable:false,align:"center"},{name:"title",sortable:false},{name:"#statusText",width:100,fixed:true,sortable:false,align:"center"}],loadui:true,
multiselect:false,onSelectRow:j,scroll:false,scrollOffset:0,altclass:"jqgrow-odd",altRows:true});a.IDS_JOB.setTypes(b["job.types"]);a.IDS_JOB.setStatus(b["job.status"]);g(e)}function g(b,e){var c,d=0;a("#data").clearGridData();for(c=0;c<b.length;c++)typeof e=="function"&&e(b[c])==false||(a.IDS_JOB.initJob(b[c]),a("#data").addRowData(c+1,b[c]),d++);a("#total").text("Total:"+d+"\u6761\u8bb0\u5f55!")}function j(b){var e=a("#data").getRowData(b),e=a.toJSON({id:e.id});a.ajax({type:"POST",contentType:"application/json",
url:IDS_CONTEXT_PATH+"/job/open",data:e,dataType:"json",success:function(a){k(b,a)},error:function(){ajaxError(arguments,this)}})}function k(b,e){a("#job_list").hide();a.IDS_JOB.openJob(e,{"##onJobSave":function(c){a.IDS_JOB.closeAll();a("#job_list").show();a("#data").setRowData(b,c)},"#onJobDelete":function(){a.IDS_JOB.closeAll();a("#job_list").show();a("#data").delRowData(b)},"#onJobReturn":function(c){a("#job_list").show();a("#data").setRowData(b,c)},"#onActReturn":function(c){a("#job_list").show();
a("#data").setRowData(b,c)}})}function f(){var b={};b.date_from=a("#date_from").val().parseDate(IDS_FORMAT_DATE);b.date_to=a("#date_to").val().parseDate(IDS_FORMAT_DATE);b.type=a("#job_type").val();b.status=a("#job_status").val();b.keyword=a("#job_keyword").val();g(h.jobs,function(a){var c=true,d;if(!a)return false;c&&b.date_from!=null&&!isNaN(b.date_from)&&(c=c&&a.reqTime>=b.date_from);c&&b.date_to!=null&&!isNaN(b.date_to)&&(c=c&&a.reqTime<=b.date_to);if(c&&b.type)d=b.type,c=c&&(d=="@ALL"||d==a["#typeValue"].code);
if(c&&b.status)d=b.status,c=c&&(d=="@ALL"||d==a["#statusValue"].code);if(c&&b.keyword!="")d=b.keyword,c=c&&(a.title&&a.title.indexOf(d)>=0||a.content&&a.content.indexOf(d)>=0);return c})}function l(){a("#date_from").val("");a("#date_to").val("");a("#job_type").val("@ALL");a("#job_status").val("@ALL");a("#job_keyword").val("");g(h.jobs)}var h;a.MY_JOB=a.MY_JOB||{version:"1.0.0",name:"MY_JOB"};a.extend(a.MY_JOB,{init:function(b){h=b;a("#job_type").addOptions(b["job.types"],{value:"code",text:"text"});
a("#job_status").addOptions(b["job.status"],{value:"code",text:"text"});a("#date_from").datepicker({buttonImage:"",showOn:"focus",onSelect:function(){f()}});a("#date_to").datepicker({buttonImage:"",showOn:"focus",onSelect:function(){f()}});a("#job_type").bind("change",f);a("#job_status").bind("change",f);a("#btn_search").bind("click",f);a("#btn_reset").bind("click",l);i(b)}})})(jQuery);
$(function(){$.IDS_MENU.init(1);$.ajax({type:"POST",contentType:"application/json",data:"{}",dataType:"json",url:IDS_CONTEXT_PATH+"/job/list",success:$.MY_JOB.init,error:function(){ajaxError(arguments,this)}})});
