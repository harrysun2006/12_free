(function(a){function h(b,d){var c=b.jobs,e,g=0;a("#data").clearGridData();for(e=0;e<c.length;e++)typeof d=="function"&&d(c[e])==false||(a.IDS_JOB.initJob(c[e]),a("#data").addRowData(e+1,c[e]),g++);a("#total").text("Total:"+g+"\u6761\u8bb0\u5f55!");e={pernr:IDS_ALL.code,text:IDS_ALL.text};b["job.dept0.emps"]&&(c=Array(e).concat(b["job.dept0.emps"]),g=f&&f.requester?f.requester:IDS_ALL.code,a("#job_requester").addOptions(c,{value:"pernr",text:"name",svalue:g}));b["job.dept1.emps"]&&(c=Array(e).concat(b["job.dept1.emps"]),
g=f&&f.actor?f.actor:IDS_ALL.code,a("#job_actor").addOptions(c,{value:"pernr",text:"name",svalue:g}))}function j(b){var d=a("#data").getRowData(b),d=a.toJSON({id:d.id});a.ajax({type:"POST",contentType:"application/json",url:IDS_CONTEXT_PATH+"/job/open",data:d,dataType:"json",success:function(a){k(b,a)},error:function(){ajaxError(arguments,this)}})}function k(b,d){a("#job_list").hide();a.IDS_JOB.openJob(d,{"##onJobSave":function(c){a.IDS_JOB.closeAll();a("#job_list").show();a("#data").setRowData(b,
c)},"#onJobDelete":function(){a.IDS_JOB.closeAll();a("#job_list").show();a("#data").delRowData(b)},"#onJobReturn":function(c){a("#job_list").show();a("#data").setRowData(b,c)},"#onActReturn":function(c){a("#job_list").show();a("#data").setRowData(b,c)}})}function i(){var b=a("#date_from").val().parseDate(IDS_FORMAT_DATE),d=a("#date_to").val().parseDate(IDS_FORMAT_DATE),b={date_from:b==null||isNaN(b)?null:b.format(IDS_FORMAT_DATE),date_to:d==null||isNaN(d)?null:d.format(IDS_FORMAT_DATE),cat:a("#job_cat").val(),
fsFlag:a("#job_fsFlag").val(),rank:a("#job_rank").val(),dept0:a("#job_dept0").val(),requester:a("#job_requester").val(),status:a("#job_status").val(),dept1:a("#job_dept1").val(),actor:a("#job_actor").val(),keyword:a("#job_keyword").val()};f={};for(var c in b)b[c]&&b[c]!=IDS_ALL.code&&(f[c]=b[c]);a.ajax({type:"POST",contentType:"application/json",data:a.toJSON({extra:f}),dataType:"json",url:IDS_CONTEXT_PATH+"/job/query",success:function(a){h(a)},error:function(){ajaxError(arguments,this)}})}var f;
a.QUERY_JOB=a.QUERY_JOB||{version:"1.0.0",name:"QUERY_JOB"};a.extend(a.QUERY_JOB,{init:function(b){var d=Array(IDS_ALL).concat(b["job.cats"]),c=Array(IDS_ALL).concat(b["job.fsFlags"]),e=Array(IDS_ALL).concat(b["job.ranks"]),f=Array(IDS_ALL).concat(b["job.teams"]);a("#job_status").addOptions(b["job.status"]);a("#job_cat").addOptions(d);a("#job_fsFlag").addOptions(c);a("#job_rank").addOptions(e);a("#job_dept0").addOptions(f,{text:"name",children:"groups"});a("#job_dept1").addOptions(f,{text:"name",
children:"groups"});a("#data").jqGrid({autowidth:true,datatype:"local",height:"auto",colNames:"ID,\u65f6\u95f4,\u63d0\u6848\u90e8\u95e8,\u63d0\u6848\u8005,\u63d0\u6848\u7c7b\u578b,\u4e3b\u9898,\u72b6\u6001,\u7b49\u7ea7,\u5f97\u5206".split(","),colModel:[{name:"id",hidden:true},{name:"reqTime",index:"reqTime",formatter:"date",width:120,fixed:true,sortable:false,align:"center"},{name:"#dept1",width:80,fixed:true,sortable:false},{name:"#requester",width:100,fixed:true,sortable:false},{name:"#catText",
width:80,fixed:true,sortable:false,align:"center"},{name:"title",sortable:false},{name:"#statusText",width:100,fixed:true,sortable:false,align:"center"},{name:"#rank",width:60,fixed:true,sortable:false,align:"center"},{name:"#score",width:60,fixed:true,sortable:false,align:"center"}],loadui:true,multiselect:false,onSelectRow:j,scroll:false,scrollOffset:0,altclass:"jqgrow-odd",altRows:true});a.IDS_JOB.setTypes(b["job.types"]);a.IDS_JOB.setStatus(b["job.status"]);a.IDS_JOB.setCats(b["job.cats"]);h(b)},
search:i,reset:function(){a("#date_from").val("");a("#date_to").val("");a("#job_cat").val(IDS_ALL.code);a("#job_fsFlag").val(IDS_ALL.code);a("#job_rank").val(IDS_ALL.code);a("#job_dept0").val(IDS_ALL.code);a("#job_requester").val(IDS_ALL.code);a("#job_status").val(IDS_ALL.code);a("#job_dept1").val(IDS_ALL.code);a("#job_actor").val(IDS_ALL.code);a("#job_keyword").val("");i()}})})(jQuery);
$(function(){$.IDS_MENU.init(2);$.ajax({type:"POST",contentType:"application/json",data:"{}",dataType:"json",url:IDS_CONTEXT_PATH+"/job/query",success:$.QUERY_JOB.init,error:function(){ajaxError(arguments,this)}});$("#date_from").datepicker({buttonImage:"",showOn:"focus",onSelect:function(){$.QUERY_JOB.search()}});$("#date_to").datepicker({buttonImage:"",showOn:"focus",onSelect:function(){$.QUERY_JOB.search()}});$("#job_cat").bind("change",$.QUERY_JOB.search);$("#job_fsFlag").bind("change",$.QUERY_JOB.search);
$("#job_rank").bind("change",$.QUERY_JOB.search);$("#job_dept0").bind("change",$.QUERY_JOB.search);$("#job_requester").bind("change",$.QUERY_JOB.search);$("#job_status").bind("change",$.QUERY_JOB.search);$("#job_dept1").bind("change",$.QUERY_JOB.search);$("#job_actor").bind("change",$.QUERY_JOB.search);$("#btn_search").bind("click",$.QUERY_JOB.search);$("#btn_reset").bind("click",$.QUERY_JOB.reset)});
