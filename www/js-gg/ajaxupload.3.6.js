(function(){function q(a){typeof a=="string"&&(a=f.getElementById(a));return a}function i(a,b,c){l.addEventListener?a.addEventListener(b,c,false):l.attachEvent&&a.attachEvent("on"+b,function(){c.call(a,l.event)})}function r(a,b){a.className.match(RegExp("(\\s|^)"+b+"(\\s|$)"))||(a.className+=" "+b)}function n(a,b){a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," ")}function s(a){if(!a.pageX&&a.clientX){var b=1,c=document.body;c.getBoundingClientRect&&(b=c.getBoundingClientRect(),b=
(b.right-b.left)/c.clientWidth);return{x:a.clientX/b+f.body.scrollLeft+f.documentElement.scrollLeft,y:a.clientY/b+f.body.scrollTop+f.documentElement.scrollTop}}return{x:a.pageX,y:a.pageY}}var f=document,l=window,o=function(){var a=f.createElement("div");return function(b){a.innerHTML=b;b=a.childNodes[0];a.removeChild(b);return b}}(),p=document.documentElement.getBoundingClientRect?function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,a=c.body,c=c.documentElement,e=c.clientTop||a.clientTop||
0,d=c.clientLeft||a.clientLeft||0,h=1;a.getBoundingClientRect&&(h=a.getBoundingClientRect(),h=(h.right-h.left)/a.clientWidth);h>1&&(d=e=0);return{top:b.top/h+(window.pageYOffset||c&&c.scrollTop/h||a.scrollTop/h)-e,left:b.left/h+(window.pageXOffset||c&&c.scrollLeft/h||a.scrollLeft/h)-d}}:function(a){if(l.jQuery)return jQuery(a).offset();var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0;while(a=a.offsetParent);return{left:c,top:b}},t=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();
Ajax_upload=AjaxUpload=function(a,b){a.jquery?a=a[0]:typeof a=="string"&&/^#.*/.test(a)&&(a=a.slice(1));a=q(a);this._input=null;this._button=a;this._justClicked=this._submitting=this._disabled=false;this._parentDialog=f.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var c=jQuery(this._button).parents(".ui-dialog");if(c.length)this._parentDialog=c[0]}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,responseType:false,onChange:function(){},onSubmit:function(){},onComplete:function(){}};
for(var e in b)this._settings[e]=b[e];this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input)this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null},_createInput:function(){var a=this,b=f.createElement("input");b.setAttribute("type","file");b.setAttribute("name",this._settings.name);var c={position:"absolute",
margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583},e;for(e in c)b.style[e]=c[e];if(b.style.opacity!=="0")b.style.filter="alpha(opacity=0)";this._parentDialog.appendChild(b);i(b,"change",function(){var b=this.value.replace(/.*(\/|\\)/,"");a._settings.onChange.call(a,b,/[.]/.exec(b)?/[^.]+$/.exec(b.toLowerCase()):"")!=false&&a._settings.autoSubmit&&a.submit()});i(b,"click",function(){a.justClicked=true;setTimeout(function(){a.justClicked=
false},2500)});this._input=b},_rerouteClicks:function(){var a,b,c,e,d=this,h={top:0,left:0},j=false;i(d._button,"mouseover",function(){if(d._input&&!j){j=true;var g=d._button,m,k,i;k=p(g);m=k.left;i=k.top;k=m+g.offsetWidth;a=m;b=k;c=i;e=i+g.offsetHeight;d._parentDialog!=f.body&&(h=p(d._parentDialog))}});i(document,"mousemove",function(g){var f=d._input;if(f&&j)if(d._disabled)n(d._button,"hover"),f.style.display="none";else if(g=s(g),g.x>=a&&g.x<=b&&g.y>=c&&g.y<=e)f.style.top=g.y-h.top+"px",f.style.left=
g.x-h.left+"px",f.style.display="block",r(d._button,"hover");else{j=false;var i=setInterval(function(){if(!d.justClicked){if(!j)f.style.display="none";clearInterval(i)}},25);n(d._button,"hover")}})},_createIframe:function(){var a=t(),b=o('<iframe src="javascript:false;" name="'+a+'" />');b.id=a;b.style.display="none";f.body.appendChild(b);return b},submit:function(){var a=this,b=this._settings;if(this._input.value!==""){var c=this._input.value.replace(/.*(\/|\\)/,"");if(b.onSubmit.call(this,c,/[.]/.exec(c)?
/[^.]+$/.exec(c.toLowerCase()):"")!=false){var e=this._createIframe(),d=this._createForm(e);d.appendChild(this._input);d.submit();f.body.removeChild(d);this._input=d=null;this._createInput();var h=false;i(e,"load",function(){if(e.src=="javascript:'%3Chtml%3E%3C/html%3E';"||e.src=="javascript:'<html></html>';")h&&setTimeout(function(){f.body.removeChild(e)},0);else{var d=e.contentDocument?e.contentDocument:frames[e.id].document;if(!(d.readyState&&d.readyState!="complete")&&!(d.body&&d.body.innerHTML==
"false")){var g;if(d.XMLDocument)g=d.XMLDocument;else if(d.body){if(g=d.body.innerHTML,b.responseType&&b.responseType.toLowerCase()=="json"){if(d.body.firstChild&&d.body.firstChild.nodeName.toUpperCase()=="PRE")g=d.body.firstChild.firstChild.nodeValue;g=g?window.eval("("+g+")"):{}}}else g=d;b.onComplete.call(a,c,g);h=true;e.src="javascript:'<html></html>';"}}})}else f.body.removeChild(this._input),this._input=null,this._createInput()}},_createForm:function(a){var b=this._settings,c=o('<form method="post" enctype="multipart/form-data"></form>');
c.style.display="none";c.action=b.action;c.target=a.name;f.body.appendChild(c);for(var e in b.data)a=f.createElement("input"),a.type="hidden",a.name=e,a.value=b.data[e],c.appendChild(a);return c}}})();
